
Bu alttaki psuh bildirimleri için kuruldu. Flutter da gelen bildirimleri nasıl gösteririrm if (!function_exists('base64_url_encode')) { function base64_url_encode(string $input): string { return str_replace('=', '', strtr(base64_encode($input), '+/', '-_')); } } if (!function_exists('getFCMAccessToken')) { function getFCMAccessToken() { $jwt_header_array = array("alg" => "RS256", "typ" => "JWT"); $jwt_claim_array = array( "iss" => "firebase-adminsdk-fbsvc@pos701-c070d.iam.gserviceaccount.com", "scope" => "https://www.googleapis.com/auth/firebase.messaging", "aud" => "https://oauth2.googleapis.com/token", "exp" => time() + 3600, "iat" => time() ); $jwt_header = base64_url_encode(json_encode($jwt_header_array)); $jwt_claim = base64_url_encode(json_encode($jwt_claim_array)); $key = "-----BEGIN PRIVATE KEY-----\nMIIEvQIBADANBgkqhkiG9w0BAQEFAASCBKcwggSjAgEAAoIBAQCl7B+hbcftBBrf\n771HO3ilYBtVl6jm2Sd+Rw2tRKvVioOSEchlwfG2KYWluvbZyFqAMYFjEEQbrHjt\nyERYe9rTtp1R5qEZN8pz4KDcIxELxzU3cBzNgI3ARMu4vmvJndf/4Du30JuTpd+e\n59UW9GotaKxbwJ+mQguVbDQTjqZWiLxl2NQL7Y2c4hllIH1LnpCgbzQjmfPPeNtI\ngp60PABUsE4qBgSt61q3yyUbeUl0LmDFuDvvG9j2qXdiS4xY9QWA2f+KLrOZ4fcQ\nJjNJmcMIqhCFST4+BVf04i1vx52rqc3DI2xUbL7jArVZ0fFY5BVy45Eb8yXkJg9R\niEQeuV11AgMBAAECggEAMe9Hr7IV3q+DFQ0WJldwHjk30MElXGBTQe5JX/GQU2Jt\n6Wp/qJw/TebeKXwEqZNiJT2A5prxHHECLfG9G/Ieb+QAIbNqnWfMfqZGUyocibJo\nwif0CybawlgSBaYNU261IHVQE6htAfkEPVMhLtjdEZB0euKUSZmL2eroG1Ctn9Hn\nX36hXYrISUAQiDqhdUnG92iOrkfpj2mn+otTrHbroLef+PEXSAhiz82IkPUEmuuY\nHNQERyLFh0mwLY1rA/auCb1vVP9oS46od9C9ooL99JWnSas9FfF0oAG6TqLj90vp\nxq3KwFE6XoGjBFT+W58cwC0/OnvuHALuCy66vQEN6wKBgQDisd2zFC4ZNI772OPN\nAv4lS7gamaXNnVMgNCpPP2Nancvyr4ABpPmUBkz6eLZRullI5OIHOZskwRJdYdB8\nVvq5HXl+WAoRDr9jUq0IbeaO8Gl8h4M0PNg3NGTQo994QXxaskxWu70FATwPv5+q\n2g0QKZlPJafXOFsdaYqWZNU6ZwKBgQC7XxUYkV03Lt3bAUBID1HBCcqFt9dgN1zA\nhZEwoGDLQXNlEc314pna/aAxoBY0OvmplHodiekgvh5AHOXgPrMS3UYT3Usb0ufO\nTcAELsRMP5xqcJ8wNQxO/DQaOgqSomL2d+wIudRnURFvIm9ZAK4eGxBWkF79Sm1N\n1o//M5h3wwKBgQDWoE+mHJUIiBpXlyEWGJ9F8Ep95Lp10V3CP6FPJlSKlpthSYeI\nBwnEe7Kl8WOsPSILQag97uxT//fDMbiSAEegu6crV28wdyX8g2oPcP24lyVIIYS3\nEGQk4BYS8xPAZz+1HtnnxBdRhbm3r1UcDRYRF1Fu/dfKjDC3yBTODulSQQKBgGI2\nhKhMCcBTIJcbIMakwQWeTDmrE4mre0KuwFvstM/Vjtb7binkjSDssHtSnlDiWNs6\nqIezMi+nd9PDUfso4lSRB5qB9EyxUDAjMPMAUIRnE2X3gnmSVNFSAT1+DuytkZH/\naglo3p0JMUo/kn3kjV/ab8XwBtpdmM2kGfZ65QBhAoGAcxDO/i8Gf8QxJsq9oAJa\nppXDAZaIaBhMs8mjWwoR9VAF++j3t57ZvVW7PVp0rzk7UapuLyvfOSm9a/f+a431\ncgNcr//h240qlO5tafPpcQrKu+uvRh81+uo4KbieOb+mzevp2elnBu7/ljircvbS\noj/+tG1eI7lupDsbyLfs0ro=\n-----END PRIVATE KEY-----\n"; $pkeyid = openssl_pkey_get_private($key); openssl_sign($jwt_header . '.' . $jwt_claim, $jwt_signature, $pkeyid, "sha256"); $jwt_signature = base64_url_encode($jwt_signature); $jwt = $jwt_header . '.' . $jwt_claim . '.' . $jwt_signature; $url = 'https://oauth2.googleapis.com/token'; $query = 'grant_type=urn%3Aietf%3Aparams%3Aoauth%3Agrant-type%3Ajwt-bearer&assertion=' . $jwt; $ch = curl_init(); curl_setopt($ch, CURLOPT_URL, $url); curl_setopt($ch, CURLOPT_HTTPHEADER, array('Content-Type: application/x-www-form-urlencoded')); curl_setopt($ch, CURLOPT_RETURNTRANSFER, true); curl_setopt($ch, CURLOPT_FOLLOWLOCATION, true); curl_setopt($ch, CURLOPT_POST, 1); curl_setopt($ch, CURLOPT_POSTFIELDS, $query); $result = (object) json_decoder(curl_exec($ch)); return $result->access_token; } } if (!function_exists('push_notification')) { function push_notification($user_id, $title, $desc, $type, $type_id = 0) { $access_token = getFCMAccessToken(); $curl = curl_init(); curl_setopt_array($curl, array( CURLOPT_URL => 'https://fcm.googleapis.com/v1/projects/pos701-c070d/messages:send', CURLOPT_RETURNTRANSFER => true, CURLOPT_ENCODING => '', CURLOPT_MAXREDIRS => 10, CURLOPT_TIMEOUT => 0, CURLOPT_FOLLOWLOCATION => true, CURLOPT_HTTP_VERSION => CURL_HTTP_VERSION_1_1, CURLOPT_CUSTOMREQUEST => 'POST', CURLOPT_POSTFIELDS => '{ "message": { "topic": "' . $user_id . '", "notification": { "title": "' . $title . '", "body": "' . $desc . '" }, "data": { "keysandvalues": "{\\"type\\": \\"' . $type . '\\", \\"id\\": ' . $type_id . '}" } } }', CURLOPT_HTTPHEADER => array( 'Content-Type: application/json', 'Authorization: Bearer ' . $access_token ), )); $response = curl_exec($curl); curl_close($curl); return $response; } }